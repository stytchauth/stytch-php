<?php

// !!!
// WARNING: This file is autogenerated
// Only modify code within MANUAL() sections
// or your changes may be overwritten later!
// !!!

namespace Stytch\B2B\Models\Sessions;

final class AuthenticateJwtLocalRequest
{
    /** The JWT to authenticate. */
    public string $sessionJwt;

    /**
     * The maximum allowable difference when comparing timestamps (in seconds).
     * Defaults to 0 seconds. Used to account for clock skew between systems.
     */
    public ?int $clockToleranceSeconds = null;

    /**
     * If set, the JWT must have been issued (based on the "iat" claim) no more than this many seconds ago.
     * If set to 0, all tokens will be considered too old.
     */
    public ?int $maxTokenAgeSeconds = null;

    /**
     * The current date to use for timestamp comparisons. Defaults to the current date/time.
     * Primarily used for testing.
     */
    public ?\DateTimeInterface $currentDate = null;

    /**
     * If an `authorization_check` object is passed in, this endpoint will also check if the Member is
     * authorized to perform the given action on the given Resource. A Member is authorized if they are
     * assigned a Role with adequate permissions.
     *
     * If the Member is not authorized to perform the specified action on the specified Resource, a 403 error
     * will be thrown. Otherwise, the response will contain a list of Roles that satisfied the authorization check.
     */
    public ?AuthorizationCheck $authorizationCheck = null;

    public function __construct(
        string $sessionJwt,
        ?int $clockToleranceSeconds = null,
        ?int $maxTokenAgeSeconds = null,
        ?\DateTimeInterface $currentDate = null,
        ?AuthorizationCheck $authorizationCheck = null
    ) {
        $this->sessionJwt = $sessionJwt;
        $this->clockToleranceSeconds = $clockToleranceSeconds;
        $this->maxTokenAgeSeconds = $maxTokenAgeSeconds;
        $this->currentDate = $currentDate;
        $this->authorizationCheck = $authorizationCheck;
    }

    /**
     * Create an instance from an array
     *
     * @param array $data
     * @return static
     */
    public static function fromArray(array $data): static
    {
        $currentDate = null;
        if (isset($data['current_date'])) {
            if ($data['current_date'] instanceof \DateTimeInterface) {
                $currentDate = $data['current_date'];
            } elseif (is_string($data['current_date'])) {
                $currentDate = new \DateTimeImmutable($data['current_date']);
            }
        }

        return new static(
            $data['session_jwt'],
            $data['clock_tolerance_seconds'] ?? null,
            $data['max_token_age_seconds'] ?? null,
            $currentDate,
            isset($data['authorization_check']) && $data['authorization_check'] !== null ? AuthorizationCheck::fromArray($data['authorization_check']) : null
        );
    }

    /**
     * Convert to array
     *
     * @return array
     */
    public function toArray(): array
    {
        return [
            'session_jwt' => $this->sessionJwt,
            'clock_tolerance_seconds' => $this->clockToleranceSeconds,
            'max_token_age_seconds' => $this->maxTokenAgeSeconds,
            'current_date' => $this->currentDate,
            'authorization_check' => $this->authorizationCheck,
        ];
    }
}
